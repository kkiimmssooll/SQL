## 6-1. Intro
- 가독성을 챙기기 위한 SQL 스타일 가이드
- 데이터 결과 검증
- 데이터 결과 검증 예시

## 6-2. 가독성을 챙기기 위한 SQL 스타일 가이드
- 다른 사람이 볼 때 부연 설명이 필요없을 정도로 이해하기 쉽게
- Mozilla(Firefox)의 SQL 스타일 가이드
    - https://docs.telemetry.mozilla.org/concepts/sql_style
 

### 대표적 가이드
- 예약어는 대문자로 작성
    - SELECT, FROM, WHERE, 각종 함수..
- 컬럼 이름은 snake_case로 작성
    - event_status
- 명시적인 이름을 사용
    - 의미를 딱 보면 알 수 있게!
- 왼쪽 정렬
- 예약어나 컬럼은 한 줄에 하나씩
    - 바로 주석처리 가능
- 쉼표는 컬럼 바로 뒤에
    - 큰 차이는 없어서 회사 내 룰대로 통일


## 6-3. 가독성을 챙기기 위한 WITH 문 & 파티션
### WITH 구문??
- 똑같은 구문을 반복하면 복잡해짐
- WITH문을 사용해 쿼리를 정의해서 재사용 가능
- name_a, name_b라는 쿼리를 정의해서 재사용할 수 있게 만들어줌!
![sql6week1](/git/sql6week_1.png)

### PARTITION
- DATE를 많이 쓴다 
> 사용 이유
1. 쿼리 성능 향상
    - 탐색하는 데이터의 양이 적으므로
2. 데이터 관리 용이성
3. 비용 절감
    - 쿼리 용량에 비례해서 과금되므로

- 쿼리 우측 아래 세모를 누르면 자동으로 쿼리가 나옴
- WHERE절에 파티션 컬럼에 대해 조건 설정해서 사용
- 세부정보에 파티션 기준/필드 등 정보가 있음


## 6-4. 데이터 결과 검증 정의
> 실수의 반복을 줄이는 것이 핵심

```
SQL 쿼리 후 얻은 결과가 예상과 일치하는지 확인하는 과정
- 문제 정의 후 미리 작성(템플릿 활용)
- 도메인 특수성 잘 파악
```

### 데이터 결과 검증 시 활용하는 쿼리
1. COUNT(*) : 행 수를 확인
    의도한 데이터의 행 개수가 맞는가?
2. NOT NULL
    특정 컬럼에 NULL이 있는가?
    필수 필드가 비어있지 않는가?
3. DISTINCT : 데이터의 고유값을 확인해 중복 여부 확인
    COUNT(DISTICT 컬럼)과 COUNT(컬럼)이 동일하지 않으면 중복이 있는 것
4. IF문, CASE WHEN

### 데이터 결과 검증 시 활용 방식
1. 특정 user_id로 필터링 걸어서 확인
    3~4개의 user_id 조건을 WHERE절에 걸어서 확인
2. 샘플 데이터 생성
    WITH문을 사용해 예시 데이터 생성 후 결과 예상하고 쿼리 작성

## 6-5. 데이터 결과 검증 예시
1. 전체 데이터 파악
    컬럼을 보면서 뭘 할 수 있을지 파악
2. 특정 user_id 선정
3. 위에서 선정한 user_id 기준 승률 직접 COUNT하여 결과 예상
    테이블 보면서 직접 구해보기
4. 쿼리 작성
    구하려고 하는 것을 잘게 쪼개보기
5. 예상과 실제 결과를 비교
6. 비교 결과 맞다면 특정 유저 조건 제외

## 6-6. 정리
> 문제 정의 확인 -> Input/Ouput 작성 -> 쿼리 작성 -> 결과 비교

💡결국, 한번에 완성하려고 하지 말고 중간 과정을 거쳐가면서 하나하나 맞춰가는 것이 핵심!

![sql6week2](/git/sql6week.png)